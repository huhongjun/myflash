<?xml version="1.0" encoding="utf-8"?>
<mx:Module xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="100%" height="100%" xmlns:view="puremvc.view.component.*" creationComplete="init()">
	<mx:SWFLoader id="swfLoader" width="100%" height="90%" horizontalAlign="center" verticalAlign="middle" x="0" y="0" complete="loadComplete(event)" unload="swfUnload(event)"/>
	<view:ProgressBoardComponent id="progressBoard" x="0" horizontalAlign="center" verticalAlign="middle" width="100%" height="10%" bottom="0"/>	
	<mx:Script>
		<![CDATA[
			import mx.events.SliderEvent;
			private var mc:MovieClip;
			private var stoped:Boolean=true;	//记录当前播放状态是否停止
			private var pressing:Boolean;//进度条拖拽按钮是否按下
			
			public function init():void
			{
				progressBoard.btnPlayOrPause.addEventListener("play",play);	
				progressBoard.btnPlayOrPause.addEventListener("pause",pause);
				progressBoard.btnStop.addEventListener(MouseEvent.CLICK,stop);
				progressBoard.sldCtrlProgress.addEventListener(SliderEvent.CHANGE,progressChange);
				progressBoard.sldCtrlProgress.addEventListener(SliderEvent.THUMB_PRESS,thumbPress);
				progressBoard.sldCtrlProgress.addEventListener(SliderEvent.THUMB_RELEASE,thumbRelease);
			}
			
			private function play(evt:MouseEvent):void
			{
				if(stoped)
				{
					//sendNotification(ApplicationFacade.PLAY);
					stoped=false;
				}
			}
			
			private function pause(evt:MouseEvent):void
			{
				if(!stoped)
				{
					//sendNotification(ApplicationFacade.PAUSE);
					stoped=true;
				}	
			}				
			
			private function stop(evt:MouseEvent):void
			{
				//sendNotification(ApplicationFacade.STOP);
				if(stoped==false)
				{
					stoped=true;
					progressBoard.pauseState();
				}			
			}
			
			private function progressUpdate(value:uint):void
			{
				if(progressBoard.sldCtrlProgress.value!=progressBoard.sldCtrlProgress.maximum)
				{
					progressBoard.sldCtrlProgress.value=value;
				}
				else
				{
					if(stoped==false)
					{
						progressBoard.pauseState();
						stoped=true;
					}				
				}
			}		
			
			private function progressChange(evt:SliderEvent):void
			{ 			
				if(stoped || pressing)
				{
					//sendNotification(ApplicationFacade.GOTO_AND_STOP,evt.value);
				}
				else
				{
					//sendNotification(ApplicationFacade.GOTO_AND_PLAY,evt.value);
				}
			}
			
			private function thumbPress(evt:SliderEvent):void
			{
				//sendNotification(ApplicationFacade.PAUSE);
				pressing=true;
			}
			
			private function thumbRelease(evt:SliderEvent):void
			{
				//if(!stoped)sendNotification(ApplicationFacade.PLAY);
				pressing=false;
			}	
			
			private function loadComplete(evt:Event):void
			{
				try
				{
					mc=MovieClip(swfLoader.content);				
					mc.addEventListener(Event.ENTER_FRAME,enterFrame);									
				}
				catch(e:Error)
				{		
					mc=null;									
					trace("SWF文件转换成MovieClip对象时出错,可能与flash发布版本有关.");				
				}			
				//sendNotification(ApplicationFacade.SWF_LOAD_COMPLETE,mc.totalFrames);
			}		
			
			private function swfUnload(evt:Event):void
			{
				if(mc!=null)
				{
					mc.stop();
					mc.removeEventListener(Event.ENTER_FRAME,enterFrame);
				}
			}		
			
			private function enterFrame(evt:Event):void
			{
				//sendNotification(ApplicationFacade.ENTER_FRAME,evt.target.currentFrame);
			}	
		]]>
	</mx:Script>
</mx:Module>