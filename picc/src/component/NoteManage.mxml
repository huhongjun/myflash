<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" title="笔记管理" layout="absolute" width="620" height="440" showCloseButton="true" close="close()" creationComplete="init()" horizontalAlign="center" verticalAlign="middle" borderAlpha="1" fontWeight="normal">
	<mx:Script>
		<![CDATA[
			import mx.events.CloseEvent;
			import mx.events.ListEvent;
			import mx.formatters.DateFormatter;
			import mx.collections.ArrayCollection;			
			import mx.managers.PopUpManager;
			import mx.controls.Alert;
			
			private var lso:SharedObject;
			private var app:Object;	
			private var modifyFlag:Boolean;
			[Bindable]
			private var noteArray:ArrayCollection;			
			
			public function setApp(app:Object):void
			{
				this.app=app;
			}
			private function close():void
			{
				PopUpManager.removePopUp(this);				
			}
			private function init():void
			{
				lso=SharedObject.getLocal("noteInfo","/");
				if(lso==null)
				{
					Alert.show("无法获取本地共享对象!","Error");
				}
				else
				{
					if(lso.data.noteList==null)
					{
						noteArray=new ArrayCollection();
						lso.data.noteList=noteArray;
					}
					else
					{
						noteArray=lso.data.noteList;
					}				
				}
			}			
			private function addNote():void
			{
				if(btnAdd.label=="添加笔记")
				{
					noteForm.visible=true;
					noteList.visible=false;
					lblContent.visible=false;
					txtDisplay.visible=false;
					btnAdd.label="保存";
					btnClear.label="返回";
				}
				else
				{
					if(modifyFlag)
					{
						modifyFlag=false;
						noteArray.getItemAt(noteArray.getItemIndex(noteList.selectedItem)).title=txtTitle.text;
						noteArray.getItemAt(noteArray.getItemIndex(noteList.selectedItem)).content=txtContent.text;
					}
					else
					{
						var now:Date=new Date();
						var formatter:DateFormatter=new DateFormatter();
						formatter.formatString="YYYY-MM-DD  JJ:NN:SS";
						noteArray.addItem({title:txtTitle.text,content:txtContent.text,date:formatter.format(now)});
					}
					lso.flush();
					Alert.yesLabel="是";
					Alert.noLabel="否";					
					Alert.show("保存成功，是否继续添加？","提示",Alert.YES|Alert.NO,this,alertHandler);
				}
				
			}
			private function alertHandler(evt:CloseEvent):void
			{
				if(evt.detail==Alert.NO)
				{
					clearAll();
				}
				txtTitle.text=null;
				txtContent.text=null;
			}	
			private function clearAll():void
			{
				if(btnClear.label=="全部清空")
				{
					noteArray.removeAll();
					txtDisplay.text=null;
				}
				else
				{
					noteList.visible=true;
					lblContent.visible=true;
					txtDisplay.visible=true;
					noteForm.visible=false;
					btnAdd.label="添加笔记";
					btnClear.label="全部清空";
				}
			}			
			public function deleteItem():void
			{
				noteArray.removeItemAt(noteArray.getItemIndex(noteList.selectedItem))
			}
			public function modifyItem():void
			{
				txtTitle.text=noteList.selectedItem.title;
				txtContent.text=noteList.selectedItem.content;
				addNote();
				modifyFlag=true;
			}	
			public function displayItem():void
			{
				txtDisplay.text=noteList.selectedItem.content;
			}	
		]]>
	</mx:Script>
	
	<mx:DataGrid width="100%" height="255" id="noteList" dataProvider="{noteArray}" visible="true" rowCount="8" rollOverColor="#E6EEEE" selectionColor="#E6EEEE">
		<mx:columns>
			<mx:DataGridColumn headerText="标题" dataField="title" width="260"/>
			<mx:DataGridColumn headerText="日期" dataField="date" width="160"/>
			<mx:DataGridColumn headerText="操作">
				<mx:itemRenderer>
					<mx:Component>
						<mx:HBox horizontalAlign="center">
							<mx:Script>
								<![CDATA[
									private function modifyHandler():void
									{
										parentDocument.modifyItem();
									}
									private function deleteHandler():void
									{
										parentDocument.deleteItem();
									}
									private function displayHandler():void
									{
										parentDocument.displayItem();
									}
								]]>
							</mx:Script>
							<mx:LinkButton label="查看" click="displayHandler()"/>
							<mx:LinkButton label="修改" click="modifyHandler()"/>
							<mx:LinkButton label="删除" click="deleteHandler()"/>
						</mx:HBox>	
					</mx:Component>
				</mx:itemRenderer>
			</mx:DataGridColumn>			
		</mx:columns>	
	</mx:DataGrid>
	<mx:Form width="100%" height="100%" visible="false" horizontalCenter="0" verticalCenter="0" paddingBottom="10" paddingLeft="20" paddingRight="70" paddingTop="10" id="noteForm">
		<mx:FormItem label="标题：" width="100%">
			<mx:TextInput id="txtTitle" maxChars="30" width="100%"/>
		</mx:FormItem>
		<mx:FormItem label="内容：" width="100%" height="100%">
			<mx:TextArea width="100%" height="100%" maxChars="200" id="txtContent"/>
		</mx:FormItem>
	</mx:Form>
	<mx:Label x="3" y="257" text="内容：" textAlign="center" id="lblContent"/>
	<mx:TextArea x="41" y="258" height="96" width="558" id="txtDisplay" editable="false" borderStyle="none"/>
	
	<mx:ControlBar horizontalAlign="center" verticalAlign="middle" horizontalGap="30">
		<mx:Button id="btnAdd" label="添加笔记" click="addNote()" fontWeight="normal"/>
		<mx:Button id="btnClear" label="全部清空" click="clearAll()" fontWeight="normal"/>
	</mx:ControlBar>
</mx:TitleWindow>
